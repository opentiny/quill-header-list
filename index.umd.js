(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`quill`)):typeof define==`function`&&define.amd?define([`exports`,`quill`],t):(e=typeof globalThis<`u`?globalThis:e||self,t(e.HeaderList={},e.Quill))})(this,function(exports,t){Object.defineProperty(exports,`__esModule`,{value:!0});var n=Object.create,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,c=(e,t,n,o)=>{if(t&&typeof t==`object`||typeof t==`function`)for(var c=a(t),l=0,u=c.length,d;l<u;l++)d=c[l],!s.call(e,d)&&d!==n&&r(e,d,{get:(e=>t[e]).bind(null,d),enumerable:!(o=i(t,d))||o.enumerable});return e},l=(e,t,i)=>(i=e==null?{}:n(o(e)),c(t||!e||!e.__esModule?r(i,`default`,{value:e,enumerable:!0}):i,e));t=l(t);let u=`hl`;function d(e,t=u){let n=t?`${t}-`:``;return{b:()=>`${n}${e}`,be:t=>t?`${n}${e}__${t}`:``,bm:t=>t?`${n}${e}--${t}`:``,bem:(t,r)=>t&&r?`${n}${e}__${t}--${r}`:``,ns:e=>e?`${n}${e}`:``,bs:t=>t?`${n}${e}-${t}`:``,cv:e=>e?`--${n}${e}`:``,is:e=>`is-${e}`}}function f(e,t){let n,r=!1;return()=>{n&&clearTimeout(n),r?n=setTimeout(e,t):(e(),r=!0,setTimeout(()=>r=!1,t))}}let p=()=>Math.random().toString(36).slice(2,8),m=e=>typeof e==`function`,h=e=>typeof e==`string`,g=e=>typeof e==`number`,_=Array.isArray,v=e=>_(e)?e:[e],y=t.default.import(`formats/header`);var b=class extends y{static idKey=`data-block-id`;static create(e){let t;g(e)?t=p():(t=e.id||p(),e=e.value||0);let n=super.create(e);return n.setAttribute(this.idKey,t),n}static formats(e){let t=this.tagName.indexOf(e.tagName)+1,n=e.getAttribute(this.idKey)||p();return{id:n,value:t}}get id(){let e=this.domNode.getAttribute(this.statics.idKey);return e||(e=p(),this.domNode.setAttribute(this.statics.idKey,e)),e}},x=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    fill-rule="evenodd"
    d="M19.6 2H8.4A2.4 2.4 0 0 0 6 4.4v11.2A2.4 2.4 0 0 0 8.4 18h11.2a2.4 2.4 0 0 0 2.4-2.4V4.4A2.4 2.4 0 0 0 19.6 2M9 7a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1m1 2a1 1 0 0 0 0 2h8a1 1 0 1 0 0-2zm-1 4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1"
    clip-rule="evenodd"
  />
  <path
    fill="currentColor"
    d="M4 4a1 1 0 0 0-2 0v11.6C2 19.132 4.868 22 8.4 22H20a1 1 0 1 0 0-2H8.4A4.403 4.403 0 0 1 4 15.6z"
  />
</svg>
`,S=class e{static moduleName=`header-list`;static toolName=`header-list`;static toolbarHandle=async function(){let t=this.quill.getModule(e.moduleName);t&&t.toggleDisplay()};static register(){let n=t.default.import(`ui/icons`);n[e.toolName]=x,t.default.register({"formats/header":b},!0)}scrollContainerListener=f(this.handleScroll.bind(this),100);editorHeaders=[];isHidden=!1;bem=d(`header-list`);root;options;highlightedItem;#lastTopOffset=0;constructor(e,n){this.quill=e,this.options=this.resolveOptions({...n}),this.options.container?(this.hide(),this.root=this.buildList(),this.options.container.appendChild(this.root),this.quill.on(t.default.events.TEXT_CHANGE,f(()=>this.updateHeaders(),500)),this.quill.on(t.default.events.EDITOR_CHANGE,()=>{let[e]=this.quill.selection.getRange();e===null&&this.activeToolbarControl()})):console.warn(`header-list: options.container is required`)}resolveOptions(e){let t=h(e.container)?document.getElementById(e.container):e.container,n=e.scrollContainer?h(e.scrollContainer)?document.getElementById(e.scrollContainer):e.scrollContainer:this.quill.root;(n===window||n===document.documentElement)&&(n=null);let r,i=e.topOffset;return r=m(i)?i:g(i)?()=>i:()=>0,Object.assign({hideClass:this.bem.is(`hidden`),headerHeight:36,onBeforeShow:()=>!1,onBeforeHide:()=>!1,onItemClick:()=>{},container:t},{...e},{scrollContainer:n,topOffset:async()=>{let e=await r();return e=Number.isNaN(Number(e))?0:e,this.#lastTopOffset!==e&&(this.#lastTopOffset=e),e}})}updateHeaders(){let e=Array.from(this.quill.root.querySelectorAll(`:scope > h1, :scope > h2, :scope > h3, :scope > h4, :scope > h5, :scope > h6`)).map(e=>({el:e,blot:this.quill.scroll.find(e)})).filter(e=>e.blot),t=this.editorHeaders.map(e=>e.el).filter(t=>!e.some(e=>e.el===t)),n=[],r=[];for(let[t,i]of e.entries())this.editorHeaders.some(e=>e.el===i.el)?this.editorHeaders.some(({el:e,text:t})=>e===i.el&&t!==i.el.textContent)&&r.push(i.el):n.push({...i,index:t});this.update(n,t,r),this.editorHeaders=e.map(e=>({...e,text:e.el.textContent||``}))}bindScrollListener(){let e=window;this.options.scrollContainer&&(e=this.options.scrollContainer),e.addEventListener(`scroll`,this.scrollContainerListener)}removeScrollListener(){let e=window;this.options.scrollContainer&&(e=this.options.scrollContainer),e.removeEventListener(`scroll`,this.scrollContainerListener)}async handleScroll(){if(!this.root)return;let e=this.editorHeaders[0]?.el||null,n=this.options.scrollContainer||document.documentElement,r=await this.options.topOffset(),i=n.scrollTop,a=this.options.scrollContainer?.offsetParent||document.body,o=this.editorHeaders.map(({el:e})=>({el:e,top:C(e,a)})).filter(({top:e})=>!Number.isNaN(e)).sort((e,t)=>e.top-t.top);for(let{el:t,top:n}of o){if(n>i+r+this.options.headerHeight)break;e=t}if(!e)return;let s=t.default.import(`formats/header`),c=s.formats(e);this.setHighlight(c.id)}buildList(){let e=document.createElement(`div`);return e.classList.add(this.bem.b()),e.addEventListener(`click`,async e=>{let t=e.target;if(!t||!t.classList.contains(this.bem.be(`item`)))return;let n=t.dataset.id;n&&(await this.scrollToHeaderById(n),m(this.options.onItemClick)&&this.options.onItemClick(n))}),e}async scrollToHeaderById(e){let n=t.default.import(`formats/header`),r=v(n.tagName),i=r.map(t=>`:scope > ${t}[${n.idKey}="${e}"]`).join(`, `),a=this.quill.root.querySelector(i);if(a){let e=this.options.scrollContainer||document.documentElement,t=0;if(e===document.documentElement){let e=this.quill.root.getBoundingClientRect();t=e.top+window.scrollY}let n=await this.options.topOffset(),r=t+a.offsetTop-n;e.scrollTo({top:r})}}createListItem(e,t,n){let r=document.createElement(`div`);return r.classList.add(this.bem.be(`item`),`level-${n}`),r.dataset.id=e,r.textContent=t,r}async hide(){await this.options.onBeforeHide()||(this.options.container.classList.add(this.options.hideClass),this.isHidden=!0,this.activeToolbarControl(),this.removeScrollListener())}async show(){await this.options.onBeforeShow()||(this.options.container.classList.remove(this.options.hideClass),this.isHidden=!1,this.activeToolbarControl(),this.handleScroll(),this.bindScrollListener())}activeToolbarControl(){let t=this.quill.getModule(`toolbar`);if(!t)return;let n=t.controls.find(([t])=>t===e.toolName);n&&(this.isHidden?n[1].classList.remove(`ql-active`):n[1].classList.add(`ql-active`))}toggleDisplay(){return this.isHidden?this.show():this.hide()}update(e,t,n){if(this.root){for(let e of t){let t=this.root.querySelector(`[data-id="${e.id}"]`);t&&t.remove()}for(let{index:t,el:n,blot:r}of e){let{header:e}=r.formats();this.root.insertBefore(this.createListItem(e.id,n.textContent||``,e.value),this.root.children[t])}for(let e of n){let t=this.root.querySelector(`[data-id="${e.id}"]`);t&&(t.textContent=e.textContent)}}}setHighlight(e){if(!this.root)return;let t=this.root.querySelector(`:scope > [data-id="${e}"]`);t&&(this.highlightedItem&&this.highlightedItem.classList.remove(this.bem.is(`highlight`)),t.classList.add(this.bem.is(`highlight`)),this.highlightedItem=t)}};function C(e,t=document.body){let n=0;for(;e!==t;){if(e===null)return NaN;n+=e.offsetTop,e=e.offsetParent}return n}var w=S;exports.HeaderList=S,exports.HeaderWithID=b,exports.default=w});
//# sourceMappingURL=index.umd.js.map