!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bundle={},t.Quill)}(this,(function(t,e){"use strict";const o=t=>"function"==typeof t,i=t=>"string"==typeof t,s=e.import("formats/header");class n extends s{static create(t){const e=super.create(t);return e.id=Math.random().toString(36).slice(2,8),e}}class r{quill;static moduleName="header-list";static toolName="header-list";static toolbarHandle=async function(){const t=this.quill.getModule(r.moduleName);t&&t.toggleDisplay()};static register(){e.import("ui/icons")[r.toolName]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M19.6 2H8.4A2.4 2.4 0 0 0 6 4.4v11.2A2.4 2.4 0 0 0 8.4 18h11.2a2.4 2.4 0 0 0 2.4-2.4V4.4A2.4 2.4 0 0 0 19.6 2M9 7a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1m1 2a1 1 0 0 0 0 2h8a1 1 0 1 0 0-2zm-1 4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1" clip-rule="evenodd"/><path fill="currentColor" d="M4 4a1 1 0 0 0-2 0v11.6C2 19.132 4.868 22 8.4 22H20a1 1 0 1 0 0-2H8.4A4.403 4.403 0 0 1 4 15.6z"/></svg>',e.register({"formats/header":n},!0)}editorHeaders=[];isHidden=!1;bem=((t,e="hl")=>{const o=e?`${e}-`:"";return{b:()=>`${o}${t}`,be:e=>e?`${o}${t}__${e}`:"",bm:e=>e?`${o}${t}--${e}`:"",bem:(e,i)=>e&&i?`${o}${t}__${e}--${i}`:"",ns:t=>t?`${o}${t}`:"",bs:e=>e?`${o}${t}-${e}`:"",cv:t=>t?`--${o}${t}`:"",is:t=>`is-${t}`}})("header-list");root;options;resizeObserver;intersectionObserver;highlightedItem;constructor(t,o){this.quill=t,this.options=this.resolveOptions({...o}),this.options.container?(this.hide(),this.root=this.buildList(),this.options.container.appendChild(this.root),this.quill.on(e.events.TEXT_CHANGE,(()=>{const t=Array.from(this.quill.root.querySelectorAll(":scope > h1, :scope > h2, :scope > h3, :scope > h4, :scope > h5, :scope > h6")),e=this.editorHeaders.map((t=>t.el)).filter((e=>!t.includes(e))),o=[],i=[];for(const[e,s]of t.entries())this.editorHeaders.some((t=>t.el===s))?this.editorHeaders.some((({el:t,text:e})=>t===s&&e!==s.textContent))&&i.push(s):o.push({el:s,index:e});this.update(o,e,i),this.editorHeaders=t.map((t=>({el:t,text:t.textContent||""})))})),this.quill.on(e.events.EDITOR_CHANGE,(()=>{const[t]=this.quill.selection.getRange();null===t&&this.activeToolbarControl()})),this.resizeObserver=new ResizeObserver((()=>{this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=new IntersectionObserver(this.handleIntersection.bind(this),{root:this.options.scrollContainer,rootMargin:`0px 0px ${this.calculateIntersectionRootMargin()}px 0px`});for(const{el:t}of this.editorHeaders)this.intersectionObserver.observe(t);const{removeEl:t,addEl:e}=this.editorHeaders.reduce(((t,{el:e},o)=>(t.addEl.push({el:e,index:o}),t.removeEl.push(e),t)),{removeEl:[],addEl:[]});this.update(e,t,[])})),this.resizeObserver.observe(this.options.scrollContainer||document.documentElement)):console.warn("header-list: options.container is required")}calculateIntersectionRootMargin(){let t=-1*(this.options.scrollContainer||document.documentElement).getBoundingClientRect().height+this.options.headerHeight;return this.options.scrollContainer||(t=-1*window.innerHeight+this.options.headerHeight),t}resolveOptions(t){const e=i(t.container)?document.getElementById(t.container):t.container;let s=t.scrollContainer?i(t.scrollContainer)?document.getElementById(t.scrollContainer):t.scrollContainer:this.quill.root;return s!==window&&s!==document.documentElement||(s=void 0),!o(t.topOffset)&&Number.isNaN(t.topOffset)&&(t.topOffset=0),Object.assign({hideClass:this.bem.is("hidden"),topOffset:0,headerHeight:36,onBeforeShow:()=>!1,onBeforeHide:()=>!1,onItemClick:()=>{},container:e},t,{scrollContainer:s})}buildList(){const t=document.createElement("div");return t.classList.add(this.bem.b()),t}createListItem(t,e,i){const s=document.createElement("div");return s.classList.add(this.bem.be("item"),`level-${i}`),s.dataset.id=t,s.textContent=e,s.addEventListener("click",(async()=>{const e=["h1","h2","h3","h4","h5","h6"].map((e=>`:scope > ${e}[id="${t}"]`)).join(", "),i=this.quill.root.querySelector(e);if(i){const t=this.options.scrollContainer||document.documentElement;let e=0;if(t===document.documentElement){e=this.quill.root.getBoundingClientRect().top+window.scrollY}const s=o(this.options.topOffset)?await this.options.topOffset():this.options.topOffset,n=e+i.offsetTop-s;t.scrollTo({top:n})}o(this.options.onItemClick)&&this.options.onItemClick(t)})),s}async hide(){await this.options.onBeforeHide()||(this.options.container.classList.add(this.options.hideClass),this.isHidden=!0,this.activeToolbarControl())}async show(){await this.options.onBeforeShow()||(this.options.container.classList.remove(this.options.hideClass),this.isHidden=!1,this.activeToolbarControl())}activeToolbarControl(){const t=this.quill.getModule("toolbar");if(!t)return;const e=t.controls.find((([t])=>t===r.toolName));e&&(this.isHidden?e[1].classList.remove("ql-active"):e[1].classList.add("ql-active"))}toggleDisplay(){return this.isHidden?this.show():this.hide()}update(t,e,o){if(this.root&&this.intersectionObserver){for(const t of e){const e=this.root.querySelector(`[data-id="${t.id}"]`);e&&(e.remove(),this.intersectionObserver.unobserve(t))}for(const{index:e,el:o}of t)this.root.insertBefore(this.createListItem(o.id,o.textContent||"",Number(o.tagName.slice(1))),this.root.children[e]),this.intersectionObserver.observe(o);for(const t of o){const e=this.root.querySelector(`[data-id="${t.id}"]`);e&&(e.textContent=t.textContent)}}}setHighlight(t){this.highlightedItem&&this.highlightedItem.classList.remove(this.bem.is("highlight")),t.classList.add(this.bem.is("highlight")),this.highlightedItem=t}handleIntersection(t){if(!this.root)return;const e=[];for(const o of t)l(o.target,this.options.scrollContainer)&&e.push(o);const o=e.reduce(((t,e)=>!t||t.boundingClientRect.y>e.boundingClientRect.y?e:t),null);let i=null;if(o&&!1!==o.isIntersecting)i=o.target;else{let t=0,e=1/0;for(const{el:o}of this.editorHeaders){const s=o.offsetTop,{isInViewport:n,onTop:r,onBottom:h}=l(o,this.options.scrollContainer);if(n){i||(i=o);break}r&&t<s?(i=o,t=s):h&&e>s&&(i=o,e=s)}}if(!i||!i.id)return;const s=i.id,n=this.root.querySelector(`:scope > [data-id="${s}"]`);n&&this.setHighlight(n)}}function l(t,e){const o=e?e.getBoundingClientRect():{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth},i=t.getBoundingClientRect();return{isInViewport:!(i.bottom<o.top||i.top>o.bottom||i.right<o.left||i.left>o.right),onTop:i.top<o.top,onBottom:i.bottom>o.bottom}}t.HeaderList=r,t.HeaderWithID=n,t.default=r,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
