!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).bundle={},t.Quill)}(this,(function(t,e){"use strict";function o(t,e){let o,i=!1;return()=>{o&&clearTimeout(o),i?o=setTimeout(t,e):(t(),i=!0,setTimeout((()=>i=!1),e))}}const i=()=>Math.random().toString(36).slice(2,8),s=t=>"function"==typeof t,n=t=>"string"==typeof t;const r=e.import("formats/header");class l{quill;static moduleName="header-list";static toolName="header-list";static toolbarHandle=async function(){const t=this.quill.getModule(l.moduleName);t&&t.toggleDisplay()};static register(){e.import("ui/icons")[l.toolName]='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M19.6 2H8.4A2.4 2.4 0 0 0 6 4.4v11.2A2.4 2.4 0 0 0 8.4 18h11.2a2.4 2.4 0 0 0 2.4-2.4V4.4A2.4 2.4 0 0 0 19.6 2M9 7a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1m1 2a1 1 0 0 0 0 2h8a1 1 0 1 0 0-2zm-1 4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1" clip-rule="evenodd"/><path fill="currentColor" d="M4 4a1 1 0 0 0-2 0v11.6C2 19.132 4.868 22 8.4 22H20a1 1 0 1 0 0-2H8.4A4.403 4.403 0 0 1 4 15.6z"/></svg>';const t=function(t){return class extends t{static create(t){const e=super.create(t);return e.id=i(),e}}}(e.import("formats/header"));e.register({"formats/header":t},!0)}scrollContainerListener=o(this.handleScroll.bind(this),100);editorHeaders=[];isHidden=!1;bem=((t,e="hl")=>{const o=e?`${e}-`:"";return{b:()=>`${o}${t}`,be:e=>e?`${o}${t}__${e}`:"",bm:e=>e?`${o}${t}--${e}`:"",bem:(e,i)=>e&&i?`${o}${t}__${e}--${i}`:"",ns:t=>t?`${o}${t}`:"",bs:e=>e?`${o}${t}-${e}`:"",cv:t=>t?`--${o}${t}`:"",is:t=>`is-${t}`}})("header-list");root;options;highlightedItem;#t=0;constructor(t,i){this.quill=t,this.options=this.resolveOptions({...i}),this.options.container?(this.hide(),this.root=this.buildList(),this.options.container.appendChild(this.root),this.quill.on(e.events.TEXT_CHANGE,o((()=>this.updateHeaders()),500)),this.quill.on(e.events.EDITOR_CHANGE,(()=>{const[t]=this.quill.selection.getRange();null===t&&this.activeToolbarControl()}))):console.warn("header-list: options.container is required")}resolveOptions(t){const e=n(t.container)?document.getElementById(t.container):t.container;let o,i=t.scrollContainer?n(t.scrollContainer)?document.getElementById(t.scrollContainer):t.scrollContainer:this.quill.root;i!==window&&i!==document.documentElement||(i=void 0);const r=t.topOffset;return s(r)?o=r:o="number"==typeof r?()=>r:()=>0,Object.assign({hideClass:this.bem.is("hidden"),headerHeight:36,onBeforeShow:()=>!1,onBeforeHide:()=>!1,onItemClick:()=>{},container:e},{...t},{scrollContainer:i,topOffset:async()=>{let t=await o();return t=Number.isNaN(Number(t))?0:t,this.#t!==t&&(this.#t=t),t}})}updateHeaders(){const t=Array.from(this.quill.root.querySelectorAll(":scope > h1, :scope > h2, :scope > h3, :scope > h4, :scope > h5, :scope > h6")),e=this.editorHeaders.map((t=>t.el)).filter((e=>!t.includes(e))),o=[],i=[];for(const[e,s]of t.entries())this.editorHeaders.some((t=>t.el===s))?this.editorHeaders.some((({el:t,text:e})=>t===s&&e!==s.textContent))&&i.push(s):o.push({el:s,index:e});this.update(o,e,i),this.editorHeaders=t.map((t=>({el:t,text:t.textContent||""})))}bindScrollListener(){let t=window;this.options.scrollContainer&&(t=this.options.scrollContainer),t.addEventListener("scroll",this.scrollContainerListener)}removeScrollListener(){let t=window;this.options.scrollContainer&&(t=this.options.scrollContainer),t.removeEventListener("scroll",this.scrollContainerListener)}async handleScroll(){if(!this.root)return;let t=this.editorHeaders[0]?.el||null;const e=this.options.scrollContainer||document.documentElement,o=await this.options.topOffset(),i=e.scrollTop,s=this.options.scrollContainer?.offsetParent||document.body,n=this.editorHeaders.map((({el:t})=>({el:t,top:a(t,s)}))).filter((({top:t})=>!Number.isNaN(t))).sort(((t,e)=>t.top-e.top));for(const{el:e,top:s}of n){if(s>i+o+this.options.headerHeight)break;t=e}t&&this.setHighlight(t.id)}buildList(){const t=document.createElement("div");return t.classList.add(this.bem.b()),t}createListItem(t,e,o){const i=document.createElement("div");return i.classList.add(this.bem.be("item"),`level-${o}`),i.dataset.id=t,i.textContent=e,i}async hide(){await this.options.onBeforeHide()||(this.options.container.classList.add(this.options.hideClass),this.isHidden=!0,this.activeToolbarControl(),this.removeScrollListener())}async show(){await this.options.onBeforeShow()||(this.options.container.classList.remove(this.options.hideClass),this.isHidden=!1,this.activeToolbarControl(),this.handleScroll(),this.bindScrollListener())}activeToolbarControl(){const t=this.quill.getModule("toolbar");if(!t)return;const e=t.controls.find((([t])=>t===l.toolName));e&&(this.isHidden?e[1].classList.remove("ql-active"):e[1].classList.add("ql-active"))}toggleDisplay(){return this.isHidden?this.show():this.hide()}update(t,e,o){if(this.root){for(const t of e){const e=this.root.querySelector(`[data-id="${t.id}"]`);e&&e.remove()}for(const{index:e,el:o}of t)this.root.insertBefore(this.createListItem(o.id,o.textContent||"",Number(o.tagName.slice(1))),this.root.children[e]);this.root.addEventListener("click",(async t=>{const e=t.target;if(!e||!e.classList.contains(this.bem.be("item")))return;const o=e.dataset.id;if(!o)return;const i=["h1","h2","h3","h4","h5","h6"].map((t=>`:scope > ${t}[id="${o}"]`)).join(", "),n=this.quill.root.querySelector(i);if(n){const t=this.options.scrollContainer||document.documentElement;let e=0;if(t===document.documentElement){e=this.quill.root.getBoundingClientRect().top+window.scrollY}const o=await this.options.topOffset(),i=e+n.offsetTop-o;t.scrollTo({top:i})}s(this.options.onItemClick)&&this.options.onItemClick(o)}));for(const t of o){const e=this.root.querySelector(`[data-id="${t.id}"]`);e&&(e.textContent=t.textContent)}}}setHighlight(t){if(!this.root)return;const e=this.root.querySelector(`:scope > [data-id="${t}"]`);e&&(this.highlightedItem&&this.highlightedItem.classList.remove(this.bem.is("highlight")),e.classList.add(this.bem.is("highlight")),this.highlightedItem=e)}}function a(t,e=document.body){let o=0;for(;t!==e;){if(null===t)return Number.NaN;o+=t.offsetTop,t=t.offsetParent}return o}t.HeaderList=l,t.HeaderWithID=class extends r{static create(t){const e=super.create(t);return e.id=i(),e}},t.default=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=dev.js.map
